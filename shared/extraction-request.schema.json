{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ExtractionRequest",
  "description": "Request from Worker to GitHub Action for PDF extraction",
  "type": "object",
  "required": ["request_id", "run_id", "source", "publication_id", "file", "extraction_schema", "created_at"],
  "properties": {
    "request_id": {
      "type": "string",
      "pattern": "^req-\\d{4}-\\d{2}-\\d{2}-\\d{3,}$",
      "description": "Unique request ID, e.g., req-2026-02-17-001"
    },
    "run_id": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Pipeline run date, e.g., 2026-02-17"
    },
    "source": {
      "type": "string",
      "enum": ["cbs-publications", "cbs-media", "gov-il-reviews"]
    },
    "publication_id": {
      "type": "string"
    },
    "file": {
      "type": "object",
      "required": ["r2_key", "original_url", "format", "expected_content"],
      "properties": {
        "r2_key": { "type": "string" },
        "original_url": { "type": "string", "format": "uri" },
        "format": { "type": "string", "enum": ["pdf"] },
        "expected_content": { "type": "string" }
      }
    },
    "extraction_schema": {
      "type": "object",
      "required": ["type", "fields"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "housing_price_index",
            "avg_apartment_prices",
            "consumer_price_index",
            "review_insights"
          ]
        },
        "fields": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    }
  }
}
